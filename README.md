# WASA Common Command&Telemetry Protocol

コマンドおよびテレメトリに用いる，統一されたシリアライズフォーマット．


# 目的
コマンドやテレメトリのフォーマットを規定する．
バイナリまたはそれに準じる形式でデータを表現することで，テキストフォーマットと比べてデータサイズを削減する．

パケットの内容についてはスキーマレス，すなわちパケットの定義を知らなくてもデコード可能とする．これにより各所でスキーマ定義を共有する手間を削減し，迅速な開発を可能にする．

CANやUARTを用いた有線通信，LoRa等による無線通信，SDカードへの記録等に用いる．


# 論理フォーマット

パケットを単位とする．パケットはヘッダと，0以上のエントリからなる．

## パケット

| 項目   | サイズ |
| ----   | ------ |
| ヘッダ | 5 byte |
| エントリ*N | 5N byte |

## ヘッダ

| 項目                 | サイズ |
| ----                 | ------ |
| ヘッダマーク（0xFF） | 1 byte |
| コマンドID           | 1 byte |
| 送信元ID             | 1 byte |
| シーケンス番号       | 1 byte |
| エントリ数           | 1 byte |

## エントリ

タイプは`64`~`127`，基本的にASCIIコードで`0~9, A~Z, a~z`を用いる．

| 項目       | サイズ | データ型 |
| ----       | ------ | ------   |
| タイプ     | 1 byte | uint8_t  |
| ペイロード | 4 byte       | 任意       |


## ペイロードデータ型

| データ型 | サイズ (byte) |
| ----     |        ------ |
| bytes    |             4 |
| uint32   |             4 |
| int32    |             4 |
| float32  |             4 |
| uint16   |             2 |
| int16    |             2 |
| float16  |             2 |
| uint8    |             1 |
| int8     |             1 |
| void     |             0 |


# 物理フォーマット

## Binary

パケットをそのままバイナリ形式で表す．ペイロード部はリトルエンディアンとする．
パケット間には5つ以上連続した`0`を挿入することができる．

## Hex

バイナリ形式を16進文字にエンコードする．ペイロード部はリトルエンディアンとするが，1byteをエンコードした2文字の組それぞれはビッグエンディアンとする．パケット間には改行コード0x0Aを挿入する．
